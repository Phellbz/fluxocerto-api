generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum MovementDirection {
  in
  out
}

enum MovementStatus {
  REALIZED
  PENDING
  CANCELED
}

enum CategoryFlowType {
  INCOME   @map("income")
  EXPENSE  @map("expense")
  TRANSFER @map("transfer")
}

model BankAccount {
  id                 String    @id @default(uuid()) @map("id")
  companyId          String    @map("company_id")
  name               String    @map("name")
  institution        String    @map("institution") @default("")
  accountType        String    @map("account_type") @default("")
  openingBalance     Decimal?  @map("opening_balance") @db.Decimal(65, 30)
  openingBalanceDate DateTime? @map("opening_balance_date") @db.Date
  isActive           Boolean   @map("is_active") @default(true)
  agency             String    @map("agency") @default("")
  accountNumber      String    @map("account_number") @default("")
  createdAt          DateTime  @default(now()) @map("created_at")

  movements Movement[]

  @@index([companyId])
  @@map("bank_accounts")
}

model Category {
  id          String           @id @default(uuid()) @map("id")
  companyId   String           @map("company_id")
  groupId     String?          @map("group_id")
  name        String           @map("name")
  flowType    CategoryFlowType @default(EXPENSE) @map("flow_type")
  affectsCash Boolean          @default(true) @map("affects_cash")
  isActive    Boolean          @default(true) @map("is_active")
  groupName   String?          @map("group_name")
  createdAt   DateTime         @default(now()) @map("created_at")

  movements Movement[]

  @@unique([companyId, name], map: "categories_company_name_unique")
  @@index([companyId])
  @@map("categories")
}

model Contact {
  id           String    @id @default(uuid()) @map("id")
  companyId    String?   @map("company_id")

  type         String    @default("customer") @map("type")
  document     String    @default("") @map("document")
  name         String    @default("") @map("name")
  tradeName    String    @default("") @map("trade_name")

  phone        String?   @map("phone")
  email        String?   @map("email")
  city         String?   @map("city")
  state        String?   @map("state")
  address      String?   @map("address")
  neighborhood String?   @map("neighborhood")
  zipCode      String?   @map("zip_code")
  createdBy    String?   @map("created_by")

  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  movements Movement[]

  @@index([companyId])
  @@map("contacts")
}

model Department {
  id          String    @id @default(uuid()) @map("id")
  companyId   String    @map("company_id")
  name        String    @map("name")
  description String?  @map("description")
  isActive    Boolean?  @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")

  movements Movement[]

  @@index([companyId])
  @@map("departments")
}

model Movement {
  id           String            @id @default(uuid()) @map("id")
  companyId    String            @map("company_id")

  occurredAt   DateTime          @map("occurred_at")
  description  String            @map("description")
  amountCents  Int               @map("amount_cents")
  direction    MovementDirection @map("direction")

  // Relacionamentos opcionais (o form manda alguns deles)
  bankAccountId String?   @map("bank_account_id")
  categoryId    String?   @map("category_id")
  contactId     String?   @map("contact_id")
  departmentId  String?   @map("department_id")

  bankAccount  BankAccount? @relation(fields: [bankAccountId], references: [id])
  category     Category?    @relation(fields: [categoryId], references: [id])
  contact      Contact?     @relation(fields: [contactId], references: [id])
  department   Department?  @relation(fields: [departmentId], references: [id])

  // Campos opcionais do seu form (deixe simples por agora)
  project       String?         @map("project")
  documentType  String?         @map("document_type")
  documentNumber String?        @map("document_number")
  observations  String?         @map("observations")

  status       MovementStatus?  @map("status")
  source       String?          @map("source")
  isReconciled Boolean?         @map("is_reconciled")

  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")

  @@index([companyId, occurredAt])
  @@index([bankAccountId])
  @@index([categoryId])
  @@index([contactId])
  @@index([departmentId])
  @@map("movements")
}
